# 시스템 설계서: 유튜브 정밀 여론 분석 엔진 (Distributed Pipeline)

## 1. 시스템 아키텍처 및 공정 분리
본 시스템은 대량의 비정형 데이터를 효율적으로 처리하기 위해 각 모듈을 독립적인 실행 파일로 분리한 **Distributed Pipeline** 아키텍처를 가집니다.

### [Phase 1] 데이터 확보 (`1_collect_data.py`)
- **기능**: 비디오 및 커뮤니티 URL 기반 댓글 크롤링.
- **최적화**: 중복 `comment_id` 체크를 통해 데이터 무결성 보장.

### [Phase 2] 텍스트 정규화 (`2_normalize_text.py`)
- **기능**: 특수문자 제거 및 키워드 추출.
- **핵심 기술**:
  - Kiwi (kiwipiepy) 형태소 분석기 기반 토큰화
  - 사용자 사전 등록 (복합어/고유명사 분리 방지)
  - 500개+ 포괄적 불용어 필터링 (조사, 어미, 감탄사, 유튜브 특화 단어 등)
- **성능 최적화**:
  - ~~맞춤법 교정 (ET5)~~ → **비활성화** (속도 우선)
  - 배치 크기: **50개** (8GB 메모리 최적화)
  - 처리 속도: **50개당 0.3초** (233배 향상)
- **특징**: 초고속 키워드 추출로 대량 데이터 실시간 처리 가능.

### [Phase 3] LLM 정밀 분석 (`4_llm_analysis.py`)
- **기능**: 사건 맥락 및 날짜 데이터를 결합한 최종 감정 판별.
- **핵심 엔진**: DeepSeek-V3 Master.
- **배치 크기**: 20개 단위 (API 비용 및 정확도 최적화).

## 2. 데이터베이스 설계
### 테이블: `im_sung_gen_youtube_comments`
| 컬럼명 | 구분 | 설명 |
| :--- | :--- | :--- |
| `comment_id` | PK | 댓글 고유 아이디 |
| `content` | Raw | 수집된 원본 텍스트 |
| `keywords` | Refined | 단계 2에서 추출된 핵심 키워드 |
| `llm_sentiment` | Final | 단계 3에서 분석된 최종 LLM 라벨 (0-5) |
| `published_at` | Time | 작성 시각 (맥락 판단의 핵심 기준) |

### 테이블: `baek_jongwon_youtube_comments`
| 컬럼명 | 구분 | 설명 |
| :--- | :--- | :--- |
| `comment_id` | PK | 댓글 고유 아이디 |
| `content` | Raw | 수집된 원본 텍스트 |
| `keywords` | Refined | 단계 2에서 추출된 핵심 키워드 |
| `llm_sentiment` | Final | 단계 3에서 분석된 최종 LLM 라벨 (0-5) |
| `published_at` | Time | 작성 시각 (맥락 판단의 핵심 기준) |

### 테이블: `daily_video_trends`
| 컬럼명 | 구분 | 설명 |
| :--- | :--- | :--- |
| 영상별 일간 트렌드 데이터 (조회수, 좋아요 등) 저장 |

## 3. 대시보드 설계 (Streamlit 멀티페이지, 총 5페이지)
- **기능**: 여론 변화 시각화, 비교 분석, 가설 검증 및 트렌드 분석.
- **페이지 구성**:
    - `dashboard_main.py` — 메인
    - `pages/1_전체_요약.py` — 임성근 전체 요약
    - `pages/2_감성_비교분석.py` — 백종원 vs 임성근 감성 비교 + 4가지 가설 검증
    - `pages/3_추이_비교분석.py` — 시계열 분석 및 주간 트렌드
    - `pages/4_상세_통계.py` — 감정별 상세 통계, 영향력 분석, CSV 다운로드
    - `pages/5_영상_트렌드.py` — 조회수/좋아요 관심지수 분석
- **핵심 차트**:
    - **가설 검증 UI**: 4가지 가설에 대한 통계적 검증 결과 시각화.
    - **감정별 고정 색상 맵**: 감정 라벨별 일관된 색상 체계 적용.
    - **주단위 여론 변화 추이**: 주간 단위 감정 변화 시계열 차트.
    - **시기별 분포 바 차트**: 1/18일 기준 전후 여론 뒤집힘 시각화.
    - **감정 그룹 파이 차트**: 긍정/부정/그외 3분할 비율.
    - **워드클라우드**: 특정 감정 그룹(부정 등)에 대한 필터링 결과 시각화.

## 4. 운영 가이드
- **실행 순서**: 1 → 2 → 3 순으로 실행 권장.
- **재분석 시**: DB에서 특정 감정 컬럼을 `NULL`로 처리한 후 해당 번호의 프로그램을 재실행.
