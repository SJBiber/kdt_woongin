# 5. 트러블 슈팅 (Problem Solving)

## 5.1 유튜브 API 호출 횟수 초과 및 데이터 누락 문제

### [문제 상황]
- 특정 기간(3개월) 동안의 동영상 데이터를 수집하던 중, 유튜브 API의 일일 할당량(Quota)을 급격하게 소모하여 크롤링이 중단되는 현상 발생.
- **원인 분석**: 
  1. 일 단위(`180일`)로 API를 반복 호출하면서 기본 호출 횟수 증가.
  2. 수집된 영상 리스트의 각 항목에 대해 상세 정보를 다시 호출하는 구조로 인해 API 호출량이 기하급수적으로 늘어남.

### [해결 과정]
- **시도 1 (실패)**: 일별 호출 대신 30일 단위로 기간을 넓혀 API 호출 횟수를 줄이려 함.
  - **부작용**: 유튜브 `search.list` API의 페이지네이션 제한(최대 약 500개)으로 인해, 업로드량이 많은 12월 데이터가 대거 누락되는 현상 발견.
- **최종 해결책**: 영상 업로드 날짜 필터(`publishedAfter`, `publishedBefore`)의 간격을 **5일 단위**로 세분화하여 호출.
  - 호출 횟수를 획기적으로 줄이면서도(`180회` -> `36회`), 500개 제한 범위 내에서 데이터 누락 없이 모든 영상을 안정적으로 수집함.

---

## 5.2 데이터베이스(DB) 내 중복 데이터 발생 이슈

### [문제 상황]
- 수집 프로그램을 재실행할 때마다 동일한 날짜의 데이터가 기존 테이블에 중복으로 `INSERT`되어, 통계 데이터의 정확도가 떨어지는 현상 발생.

### [해결 과정]
- **대안 1**: 데이터 삽입 전 미리 `SELECT` 쿼리로 날짜 존재 여부를 확인하고 `UPDATE` 또는 `INSERT` 결정.
  - **단점**: 매번 조회를 수행하므로 DB 자원 낭비 및 처리 속도 저하.
- **최종 해결책**: SQL의 **`ON CONFLICT`** 구문을 활용한 **UPSERT(Update + Insert)** 로직 적용.
  - `날짜`와 `키워드`를 고유 제약 조건(Unique Constraint)으로 설정하고, 충돌 발생 시 기존 데이터를 새로운 값으로 `UPDATE`하도록 로직을 수정하여 성능과 정합성을 모두 확보함.

---
• 배운 점: 이 과정을 통해 깨달은 것