name: YouTube 트렌드 자동 수집

on:
  schedule:
    # 매일 오후 7시 15분 (KST = UTC+9, 즉 UTC 10:15)
    - cron: '25 1 * * *'
  workflow_dispatch:  # 수동 실행 가능

jobs:
  collect:
    runs-on: ubuntu-latest
    
    steps:
    - name: 코드 체크아웃
      uses: actions/checkout@v4
    
    - name: Python 설정
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    
    - name: 의존성 설치
      run: |
        pip install -r 1.solo_project/youtube_trend_tracker/config/requirements.txt
    
    - name: 환경 변수 설정
      run: |
        mkdir -p 1.solo_project/youtube_trend_tracker/config
        echo "YOUTUBE_API_KEY_1=${{ secrets.YOUTUBE_API_KEY_1 }}" >> 1.solo_project/youtube_trend_tracker/config/.env
        echo "YOUTUBE_API_KEY_2=${{ secrets.YOUTUBE_API_KEY_2 }}" >> 1.solo_project/youtube_trend_tracker/config/.env
        echo "SUPABASE_URL=${{ secrets.SUPABASE_URL }}" >> 1.solo_project/youtube_trend_tracker/config/.env
        echo "SUPABASE_KEY=${{ secrets.SUPABASE_KEY }}" >> 1.solo_project/youtube_trend_tracker/config/.env
    
    - name: 데이터 수집 실행
      run: |
        cd 1.solo_project/youtube_trend_tracker/scripts
        # 전체 기간 수집 (선택: 1, 확인: y)
        echo -e "1\ny" | python3 collect.py
    
    - name: 수집 결과 업로드
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: collection-logs
        path: 1.solo_project/youtube_trend_tracker/logs/*.log
        retention-days: 7
