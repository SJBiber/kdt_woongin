name: YouTube 트렌드 자동 수집

on:
  schedule:
    # 매일 오전 9시 (KST = UTC+9, 즉 UTC 00:00)
    - cron: '0 0 * * *'
  workflow_dispatch:  # 수동 실행 가능

jobs:
  collect:
    runs-on: ubuntu-latest
    
    steps:
    - name: 코드 체크아웃
      uses: actions/checkout@v3
    
    - name: Python 설정
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: 의존성 설치
      run: |
        pip install -r config/requirements.txt
    
    - name: 환경 변수 설정
      run: |
        mkdir -p config
        echo "YOUTUBE_API_KEY_1=${{ secrets.YOUTUBE_API_KEY_1 }}" >> config/.env
        echo "YOUTUBE_API_KEY_2=${{ secrets.YOUTUBE_API_KEY_2 }}" >> config/.env
        echo "SUPABASE_URL=${{ secrets.SUPABASE_URL }}" >> config/.env
        echo "SUPABASE_KEY=${{ secrets.SUPABASE_KEY }}" >> config/.env
    
    - name: 데이터 수집 실행
      run: |
        cd scripts
        # 최근 1일 수집 (선택: 3, 일수: 1, 확인: y)
        echo -e "3\n1\ny" | python3 collect.py
    
    - name: 수집 결과 업로드
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: collection-logs
        path: logs/*.log
        retention-days: 7
